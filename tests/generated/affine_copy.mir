bar($a: int, $b: int, $ok: (int)) {
    add($a, $b, $ok)
}

bar_unwrapper($env_end: int) {
    $a: int = $env_end - 4 words (a)
    $b: int = $env_end - 3 words (b)
    $ok: (int) = $env_end - 2 words (ok)
    bar($a, $b, $ok)
}

add($x: int, $y: int, $ok: (int)) {
    $res = @add($x, $y);
    $ok($res)
}

add_unwrapper($env_end: int) {
    $x: int = $env_end - 4 words (x)
    $y: int = $env_end - 3 words (y)
    $ok: (int) = $env_end - 2 words (ok)
    add($x, $y, $ok)
}

_5_foo($ok: (), $x: int) {
    $_6 = "got: %d"
    $__result = @printf($_6, $x)
    $ok($__result)
}

_5_foo_unwrapper($env_end: int) {
    $ok: () = $env_end - 3 words (ok)
    $x: int = $env_end - 1 words (x)
    _5_foo($ok, $x)
}

foo($ok: ()) {
    $_1 = 1
    $_2 = 2
    $_3 = 3
    $_7_foo = (_5_foo_unwrapper, {()})
    $_7_foo.$ok = $ok

    $c1 = (bar_unwrapper, {int, int})
    $c1.$a = $_1
    $c1.$b = $_2

    $c1($_7_foo)
}

foo_unwrapper($env_end: int) {
    $ok: () = $env_end - 2 words (ok)
    foo($ok)
}

_9_lambda() {
    $_10 = 0
    exit($_10)
}

_9_lambda_unwrapper($env_end: int) {
    _9_lambda()
}

exit($code: int) {
    syscall exit($code)
}

exit_unwrapper($env_end: int) {
    $code: int = $env_end - 1 words (code)
    exit($code)
}

_start() {
    $_9_lambda = (_9_lambda_unwrapper, {})
    foo($_9_lambda)
}
