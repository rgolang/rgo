nil($cb: (int, ((int, ()), ())), $end: ()) {
    release $cb
    $end()
}

nil_unwrapper($env_end: int) {
    $cb: (int, ((int, ()), ())) = $env_end - 2w
    $end: () = $env_end - 1w
    release $env_end
    nil($cb, $end)
}

nil_release($env_end: int) {
    $__num_curried: int = $env_end + 5w
    if ($__num_curried < 2){ jump nil_release_if_num_curried_lt_2 }
    call @release_heap_ptr($env_end - 2w)
    call @release_heap_ptr($env_end - 1w)
    jump nil_release_done
    nil_release_if_num_curried_lt_2:
    if ($__num_curried < 1){ jump nil_release_if_num_curried_lt_1 }
    call @release_heap_ptr($env_end - 2w)
    jump nil_release_done
    nil_release_if_num_curried_lt_1:
    nil_release_done:
    return
}

nil_deepcopy($env_end: int) {
    $num_curried: int = $env_end + 5w
    if ($num_curried < 2){ jump nil_deepcopy_if_num_curried_lt_2 }
    new_env + 0w = call @deepcopy_heap_ptr($env_end - 2w)
    new_env + 1w = call @deepcopy_heap_ptr($env_end - 1w)
    jump nil_deepcopy_done
    nil_deepcopy_if_num_curried_lt_2:
    if ($num_curried < 1){ jump nil_deepcopy_if_num_curried_lt_1 }
    new_env + 0w = call @deepcopy_heap_ptr($env_end - 2w)
    jump nil_deepcopy_done
    nil_deepcopy_if_num_curried_lt_1:
    nil_deepcopy_done:
    return
}

cons($h: int, $t: ((int, ()), ()), $cb: (int, ((int, ()), ())), $end: ()) {
    release $end
    $cb($h, $t)
}

cons_unwrapper($env_end: int) {
    $h: int = $env_end - 4w
    $t: ((int, ()), ()) = $env_end - 3w
    $cb: (int, ((int, ()), ())) = $env_end - 2w
    $end: () = $env_end - 1w
    release $env_end
    cons($h, $t, $cb, $end)
}

cons_release($env_end: int) {
    $__num_curried: int = $env_end + 5w
    if ($__num_curried < 3){ jump cons_release_if_num_curried_lt_3 }
    call @release_heap_ptr($env_end - 3w)
    call @release_heap_ptr($env_end - 2w)
    call @release_heap_ptr($env_end - 1w)
    jump cons_release_done
    cons_release_if_num_curried_lt_3:
    if ($__num_curried < 2){ jump cons_release_if_num_curried_lt_2 }
    call @release_heap_ptr($env_end - 3w)
    call @release_heap_ptr($env_end - 2w)
    jump cons_release_done
    cons_release_if_num_curried_lt_2:
    if ($__num_curried < 1){ jump cons_release_if_num_curried_lt_1 }
    call @release_heap_ptr($env_end - 3w)
    jump cons_release_done
    cons_release_if_num_curried_lt_1:
    cons_release_done:
    return
}

cons_deepcopy($env_end: int) {
    $num_curried: int = $env_end + 5w
    if ($num_curried < 3){ jump cons_deepcopy_if_num_curried_lt_3 }
    new_env + 1w = call @deepcopy_heap_ptr($env_end - 3w)
    new_env + 2w = call @deepcopy_heap_ptr($env_end - 2w)
    new_env + 3w = call @deepcopy_heap_ptr($env_end - 1w)
    jump cons_deepcopy_done
    cons_deepcopy_if_num_curried_lt_3:
    if ($num_curried < 2){ jump cons_deepcopy_if_num_curried_lt_2 }
    new_env + 1w = call @deepcopy_heap_ptr($env_end - 3w)
    new_env + 2w = call @deepcopy_heap_ptr($env_end - 2w)
    jump cons_deepcopy_done
    cons_deepcopy_if_num_curried_lt_2:
    if ($num_curried < 1){ jump cons_deepcopy_if_num_curried_lt_1 }
    new_env + 1w = call @deepcopy_heap_ptr($env_end - 3w)
    jump cons_deepcopy_done
    cons_deepcopy_if_num_curried_lt_1:
    cons_deepcopy_done:
    return
}
